@@ vim:tw=9999:syntax=mush:ts=4:shiftwidth=4
@@
@@                NO EDITING OF THIS FILE IS NECESSARY
@@
@@              NOT NECESSARY TO PRE-CREATE ANY OBJECTS
@@
@@
@@  UPDATE EXISTING BBS:
@@
@@      Set these attributes on yourself first:
@@
@@          &dbref_bbs me=<dbref of existing bbs object>
@@          &dbref_bbpocket me=<dbref of existing bbpocket>
@@
@@
@@  INSTALLING BRAND NEW BBS:
@@
@@      No prerequisite actions are necessary.
@@
@@
@@  THEN:
@@
@@  Just upload this file directly to your game, it will create the
@@  necessary objects for you (if a new install) and modify all referenced
@@  dbref's in the code.
@@
@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

@set me=quiet
&_myrbb_version me=5.2.6
@pemit %#=%r%rBBS INSTALLER> Checking to see if you're set HALT.  Ignore warnings about being halted.
th [set(%#,_halt_test:[hasflag(me,halt)])]
@set me=!halt
th [setq(H,switch([hasattr(me,_halt_test)]:[v(_halt_test)],0:*,1,1:1,1,1:0,0))][set(%#,_set_halt:%qH)]
&_halt_test me
@pemit me=BBS INSTALLER> HALT flag was [ifelse(v(_set_halt),set.  It has been cleared for this installation and will be turned back on after.,not set.  Proceeding normally.)]
&_clear_sidefx me=[and(not(hasflag(me,sidefx)),switch(first(version()),RhostMUSH,1,0))]
@pemit %#=%r[switch(first(version()),RhostMUSH,,BBS INSTALLER> Ignore the following message about not understanding a flag)]
@set me=sidefx
th [switch([setr(B,v(dbref_bbs))][setr(P,v(dbref_bbpocket))][setr(Y,hasattr(%qB,CMD_+BBREAD))]:[setr(Z,hasattr(%qP,BBTIME))]:[and(%qY,%qZ)],*:*:1,BBS INSTALLER> Going to upgrade your existing BBS (%qB) and bbpocket (%qP) in place.,0:*:*,%r[repeat(*,53)]%r[ljust(***,50)]***%r*** [center(%qB does not look like a valid BBS object,45)] ***%r[ljust(***,50)]***%r[repeat(*,53)],*:0:*,%r[repeat(*,53)]%r[ljust(***,50)]***%r*** [center(%qP does not look like a valid bbpocket,45)] ***%r[ljust(***,50)]***%r[repeat(*,53)],*:*:0,{BBS INSTALLER> Going to construct a new BBS.%rBBS INSTALLER> If you want to upgrade an existing BBS, find the dbref for the BBS and the dbref of the bbpocket (usually held inside the BBS object itself), and set the following attributes on yourself:%r%r%t&DBREF_BBS me=<bbs dbref>%r%t&DBREF_BBPOCKET me=<bbpocket dbref>%r[set(%#,dbref_bbs:[create(mbboard,10)])][set(%#,dbref_bbpocket:[create(bbpocket,10)])]})]
@switch [get(me/_clear_sidefx)]=1,{@set me=!sidefx}
&_clear_sidefx me
@pemit me=[repeat(=,78)]%r[center(Constructing Myrddin's BBS v[get(me/_myrbb_version)],78)]%r[repeat(-,78)]%rDepending on your MUSH's settings, this may take a couple of minutes.  Please wait...%r
@lock [v(dbref_bbpocket)]=me
@Desc [v(dbref_bbpocket)]=[iter(setdiff(lattr(me),Desc),ljust(##,18))]
@force me={&VERSION [v(dbref_bbpocket)]=[get(me/_myrbb_version)]}
@force me={&DBREF_BBS [v(dbref_bbpocket)]=[v(dbref_bbs)]}
&VERSION_BUILD [v(dbref_bbpocket)]=b74
&SIGN_ATTRS_BBS [v(dbref_bbpocket)]=CMD_+BB CMD_+BBCATCHUP CMD_+BBCLEARGROUP CMD_+BBCOLOR CMD_+BBCOLORS CMD_+BBCOLORTHEMES CMD_+BBCONFIG CMD_+BBCONFIG2 CMD_+BBCONFIG3 CMD_+BBEDIT CMD_+BBEDIT2 CMD_+BBHELP CMD_+BBJOIN CMD_+BBLEAVE CMD_+BBLIST CMD_+BBLOCK CMD_+BBMOVE CMD_+BBNEW CMD_+BBNEW0 CMD_+BBNEWGROUP CMD_+BBNEXT CMD_+BBNEXT2 CMD_+BBNOTIFY CMD_+BBPOST CMD_+BBPOST-POST CMD_+BBPOST2 CMD_+BBPROOF CMD_+BBREAD CMD_+BBREAD2 CMD_+BBREAD2_OLD CMD_+BBREMOVE CMD_+BBREPLY CMD_+BBREPLY2 CMD_+BBSCAN CMD_+BBSEARCH CMD_+BBTIMEOUT CMD_+BBTOSS CMD_+BBVERSION CMD_+BBWRITE CMD_+BBWRITELOCK DO_CLEARGROUP cmd_+bbcolortheme cmd_+bbcolortheme/add cmd_+bbcolortheme/del cmd_+bbcolortheme/me cmd_+bbcolortheme/me/clear
&SIGN_SHA1_BBS [v(dbref_bbpocket)]=5a88842502cec9cbf834a46f8b6f0a2d92c83622 1ff6ed3b8c119e50f09f4369e34b666eb5a947ca 93eb8b1018c87fcf6192d03fe4e6cb6917e85df6 ed8552b16f18e12a7da1a6d20411dda23e35a244 8546d77e54f0984534c7ea526e660467ab5f65d0 f619c30aac4175fbaf209daca34977a1dd85a72d 0163209a64c154049b5d45fc0594e8d901aea597 84dbdddb2821d4ea290a7b46b7dff17c506cfdec 3e357a3f5e5ac8d72707972ff0835f88a8a58c11 8c9649957338740afee699e4904a87ac185dc114 a39b895f00b49117e6917f98b66361bc00641113 cab38926bd522393a84228c3b798bb9e76e7c9c5 86db81060cd789588cbcad8d0719e88d1fd4d86f 6ce9fc645398f499ddfea7c607f4515018d5d758 97d4e18db48b3aeda79be1804cba7209c8fbd063 0a6ca2a133494c71b5d5d660e99875f23c5dab9e ce19fb30dab4252b59f5231775c30bd2b0c5ccb8 8b7c524bc03022bb16acbcae04f8b4acf8a2d5f2 54ec09aa282d564cc45e359e6e61d669eb8f831f def0f9ed7344f37394fbb005cd5d21d85cad8219 5019064e13ce31344bf24febe549bed049f45433 e8944d7ce5f4675ca231c041cabdf0cf240216c7 e4b0e2afb5bd4d44e94ed98dcc01638184324c5c eb395d5db089687d7ec10c968a12d981fa92ce84 c2b8e64e310f33253e2ecfc7413dcef19ebafd94 3b38cc4695209ec3970ee107dd67eb4cfa118673 36ca56c705fb70be287d7a15a62b2a7efb01b2ad ea6add9af4b8b8296de4725f6328a6c46614b4e3 b5b3495ebe361eec7d4e08742072d6be517cf472 67ae60a4ff433de6fcd3d2e872f55395d5a9eda1 96d5e5d8f49063cf5f2ad3cd0b29fcc122464ef5 b98b5c480d7cec1b392a82043e80c98715e531ce a8ed50670ffc1da4dd0c7b8de98e89c26e22a4c2 aa9477997130446f7ca72209e645d48ad6bf6c92 25aad42dcf408c9853ef2180a4b823a18c361073 71fd8bef090ca8c848eda2c9a15468872e1517a9 1f99ad4b753d2e92cd70737383516281769a60b4 e53f03fcc226e40a2a397b3e93525c8e73d88956 5312e45d99f979eb681d6341272cd1992fa21ef3 25d9045c9d2cd2ec641c531be114cbd5c80ed1cd 261e19e539a9589eb22ec59a2e47e17ab3fb4249 8b66314c39b26f2cc243a7f8ce388fd6038798e2 f84ac8f35230f61f6677b84b7ee4bd85e0b23a7a 430c832d018310da20f674a2bd94bc629cbff493 68dbd52734bd990e3a7427b1a0c2d68807d5c2c8 7b3762e528649c4c348966c9bddf54d147fef96b
&SIGN_ATTRS_BBPOCKET [v(dbref_bbpocket)]=ADDEM B36_DIGITS B36_POWS BBTIME BBTIME_VIEW BBTIME_VIEW_DETAILS C DO_COLOR DO_TIMEOUTS D_256FLAG_MUX D_256FLAG_PENNMUSH D_256FLAG_RHOSTMUSH D_CAP D_HINTS D_NO_MESSAGES D_PZERO FN_B10-TO-B36 FN_B36-TO-B10 FN_B36_MAGS FN_BBPROMPT FN_BNAME FN_BORDER FN_BORDER_CENT FN_CENT FN_COLOR_MUX FN_COLOR_PENNMUSH FN_COLOR_RHOSTMUSH FN_FLAGS_CHECK FN_FLAGS_MSG FN_GETHINT FN_GREP FN_HACKED_ATTRS FN_HASCONFIG FN_ID FN_IDS_AND_REPLIES FN_ID_BY_ORD FN_ID_LIST FN_ID_LIST_FROM_RANGE FN_INC_NEXT_MESS FN_IS_VALID_ID FN_LINE FN_LINE_CENT FN_MAKELIST FN_MAKEREPLYLIST FN_MAPLIST FN_MESSAGE_LISTING FN_MESSAGE_SUBJECT FN_MESS_LIST_THREADED FN_MSG FN_MSG_FLAGS FN_MSG_old FN_ORD_BY_ID FN_READABLE_IDS FN_SET_FLAGS FN_SHA1 FN_SORT_B36 FN_TIMEOUT_CLOSE FN_UNREADIDS FN_UNREAD_LIST GET_GROUP ISGROUPREAD TR_CLEANUP_CLEARGROUP TR_CONFIG_ANONYMOUS TR_CONFIG_TIMEOUT TR_GCONFIG_AUTOTIMEOUT TR_GCONFIG_COLOR TR_GCONFIG_TIMEOUT TR_POST_NOTIFY TR_POST_REPLY TR_TIMEOUT TR_TIMEOUT_GROUP VALID_CONFIGS VALID_GLOBAL_CONFIGS VALID_GROUPS VERSION_BUILD
&SIGN_SHA1_BBPOCKET [v(dbref_bbpocket)]=4371d1b7662f1a7d9b92483d04bcf03a2e6dc84b ed70b187ec3178f964cb88b6424a7e1331d4f592 c0b5023587784250c0178fa148563667ed09f91f eea60a4f1d8feeb2f452ae6c93e3e962da1e171a d59a88c4cfc70cd1d54c1497ea5cfb700f57efab cc8c1faa8089c2f7f2d763f4a0645134bdc19ced fa459182823d59d7864fd23385864db36e10844a 356a192b7913b04c54574d18c28d46e6395428ab 5f9528b5bd9864feb0e059bb5f8fff66e074a351 fb13f31863863c4762b236e38035956f3ab36140 96eaa0e68337576302fc6a29516edea74b0d8f32 8eec0bbb9b363f1e7f68aad9b5e0ac7f6e6df163 92a4bc3426be3f80347fc17d2c3e9a20bf110776 c4c68bb7d0161f86664f228137825722ecfbd5c2 b187b2dcbc2ffd07d5d66a9f5e99275a6ed1e0c4 272ba522d580318b4849ce2f184ba8a60d8ab2a5 8fc9d10342b2fd1543ee0cde291461ede077615d b8653c729fd3997a68f00c033f685441792102b8 8486a2e4ec964b49c6aa248331fd26afb36fde98 2a18f8969637d83e9a3058685d7e98a55e982365 bf82fe87d8723bc3ab10047316aaa73ff5ffce1d feabb41505aeff6d621359b722fb421087975551 23a1ba2ea58c33af18dc832c46da7fad326247a1 3b136be00d21e35af775e64f1d9cf30c6231eb13 4dc041fb2caa9e28b27a2ba021ee98895e48ae64 01c41389d797b5b45f3d241ba9a928b74369cb0c 5e055438533a35d89916b2191c5b6076c480c348 c3651ce1393daf161d0ff660cf390be1500788ea 0160ac50049fc1ea6e508fe913cfaf91d25b31d1 679a3d15743f23151a728b2b03b6e3b4fc231746 97cb5ccc711803113ae4b9a996eb26526bd6b01b 9478006303111823e09b173053f68c0d8769506f 6283401579ae1eb6456c4ca2142885effc71e20e d6e9650fc1bcc90df2a2e5c794ee80bc642bb291 a452461c27c61ffeb5ed896b5a541bd8ab9e7606 1cf0f7399c459ffcb0c4251f58c54e5dd222f56c e4a4f2d6387222b5510e508626c364b1b1202be2 967161e2cde797e975783761cf9119544c7d736b 12f71ba572ea8a9d013cbda3ac7565245a133e01 c6e9d41c4c2d4b195c6ebc1e77ac6f449ce42640 294a9aca361e2a928f6990838d1f0ef2eb3cf826 a8e108d99abc98d226984815dc2c5f51ae023e8b 2566cff9e6f962a97551eb817c9f9e8d73dcaba8 42d757fcc10720b7a2ac65fd1228705ec6259aa5 8f1c431b0b1400e7cc94ca503d760d8029e2d1fd d68a3c0ed259f6531b80b438f2713488ee2b7d2d ee2d434c9e7da72c817fb16d23deefa2d3f322a0 2147384a761791bf2d9f5d5c2a94d72f316f24d1 879127b9188ae4039dfa2f7c7c01ec394a1bf9de 5b33ac693567f613973869a63e41a9feeeb5856a 566012eaa3e4b5f9ec846525cdc9aeb8e03fd713 42f966821139092c9c52fab4e36ede341cd33261 53e26a3b3804c4eb320c9d4308b19bffec9a3224 43a7c9938cddbb0da0800ce8499ae9739c321470 c05e22aa769cbca208d71e7f7573f5eeda226283 4ed0e1c150a52545351912f64aff02f5dd2671ec faf117f14e6fbfe2e1396416f5e5fd69c7125684 75e9f1e2eee9be5e9e8559617e6ea2d75fb5f751 18cd23569a27582f6faabc49eb46b21d7f8f7c7d bd8b2aa2db27a769868c7d00cba39366736ee9dc f6a5128bfcd7147c222c6e3b063bf7a5274ba17a f840992a693b4a5c8c6d6947bec888f70cde521e 08b4f91beb993f1c2b26ee7d14cd8700bb381d93 308178c7f89d8dae1764b40210dee9f90ddec768 68416e7be38288faa81a4106ad906ee248fb0c77 636914661d65edb357406922590072e28e7ab294 bcaf342104672855246d86fdb85cc638e90be3e6 c02cd3b2b98f62996e9cf86fe15300c77c5f477e e046b7230843c2ed5eab123dc8881cb30fa4ae2e 4f2c85e3bb7b4ad642ac3df31ee10e651d26ec92 fe2fe435217ee89dad54fc910193e9f03b2c02f6 a88745fc0dae2a2cfdb30b3893607b3dfc12527a 2ae5f77a94f24c2be497a0a4e49167b296a67fc1 dbc2cdf0f1e486b993ab8477ada6be27c23b68c6 5dfbc7bee8edde316abbd70e419d3c1704f2f445
&FN_SHA1 [v(dbref_bbpocket)]=[setq(R,get(%0/%1))][setq(C,switch([version()]:[lcstr(%1)],Penn*:cmd_+bbnewgroup,edit(edit(%qR,wizard,inherit),@set \\%%q0=NO_WARN; &CANREAD,&CANREAD),%qR))][lcstr(digest(sha1,squish(edit(%qC,%!,#000))))]
&BBTIME [v(dbref_bbpocket)]=secs()
&BBTIME_VIEW [v(dbref_bbpocket)]=ifelse(isnum(%0),ldelete(convsecs(%0),4),%0)
&BBTIME_VIEW_DETAILS [v(dbref_bbpocket)]=ifelse(isnum(%0),convsecs(%0),%0)
&GET_GROUP [v(dbref_bbpocket)]=switch(isnum(%0),1,extract(v(groups),%0,1),locate(#bbpocket,%0,ni))
@switch words(get([v(dbref_bbpocket)]/nxt_mess))=0,{ &NXT_MESS [v(dbref_bbpocket)]=1 }
&VALID_GROUPS [v(dbref_bbpocket)]=iter(v(groups),switch(and(u(##/can%1,%0),not(member(get(%0/bb_omit),##))),1,##))
&ISGROUPREAD [v(dbref_bbpocket)]=switch(setdiff(%1,get(%0/bb_read)),,,u(c,unread,U))
&FN_UNREADIDS [v(dbref_bbpocket)]=[setq(L,ulocal(fn_mess_list_threaded,%1))][sort(setdiff(%qL,get(%0/bb_read)))]
&FN_MAKELIST [v(dbref_bbpocket)]=map(me/fn_maplist,secure(%0))
&FN_MAKELIST [v(dbref_bbpocket)]=map(me/fn_maplist,secure(%0))
&FN_MAPLIST [v(dbref_bbpocket)]=switch([strmatch(%0,?*-*)]:[strmatch(%0,*.*)],1:0,lnum(before(%0,-),after(%0,-)),1:1,ulocal(fn_makereplylist,%0),%0)
&FN_MAKEREPLYLIST [v(dbref_bbpocket)]=[setq(B,first(%0,-))][setq(E,rest(%0,-))][ifelse(strmatch(%0,*.*),[setq(X,rest(%qB,.))][setq(Y,rest(%qE,.))][ifelse(%qX,setq(B,first(%qB,.)),[setq(X,1)]%qB%b)][iter(lnum(%qX,%qY),%qB.##)],lnum(%qB,%qE))]
&FN_MESSAGE_SUBJECT [v(dbref_bbpocket)]=edit(index(%0,|,ifelse(%1,%1,1),1),__PIPE__,|)
&FN_MESSAGE_LISTING [v(dbref_bbpocket)]=[setq(D,%0)][setq(B,%1)][setq(M,%2)][ljust([u(c,3,[member(v(groups),%qB)]/[ifelse(hasattr(%qB,parent_%qM),[member(get(%qB/MESS_LST),setr(P,get(%qB/parent_%qM)))].[member(get(%qB/reply_%qP),%qM)],[member(get(%qB/MESS_LST),%qM)])])],9)][ljust(ulocal(fn_msg_flags,%qD,%qB,%qM),2)][ifelse(hasattr(%qB,parent_%qM),[setq(R,get(%qB/reply_[get(%qB/parent_%qM)]))][setq(S,32)]%b[u(c,2,switch(member(%qR,%qM),words(%qR),`,|))]%b,setq(S,35))][ljust(left(u(fn_message_subject,setr(1,get(%qB/HDR_%qM))),sub(%qS,1)),%qS)][ljust(u(bbtime_view,index(%q1,|,2,1)),19)][mid([u(fn_bname,index(%q1,|,3,1))][ifelse(and(hasattr(%qB,anonymous),u(fn_bbs_staff,%qD)),%b\([u(fn_bname,index(%q1,|,4,1))]\),)],0,21)]
&FN_MAPLIST_2 [v(dbref_bbpocket)]=switch(strmatch(%0,*-*),1,u(fn_lnum,before(%0,-),after(%0,-)),%0)
&FN_UNREAD_LIST [v(dbref_bbpocket)]=edit(sort(iter(%0,member(%1,##))),%b,\,%b)
&FN_UNREAD_LIST [v(dbref_bbpocket)]=edit(sort(iter(%0,u(fn_ord_by_id,%2,##))),%b,\,%b)
&FN_LNUM [v(dbref_bbpocket)]=iter(lnum(add(sub(%1,%0),1)),add(##,%0))
@switch lnum(1,2)=1 2,{@pemit %#=BBS INSTALLER> Your lnum() accepts two arguments. Good.;&FN_MAPLIST_2 [v(dbref_bbpocket)];&FN_LNUM [v(dbref_bbpocket)]},{@pemit %#=BBS INSTALLER> Hmmm. Your lnum() is archaic... I'll have to use my own.;@mvattr [v(dbref_bbpocket)]=FN_MAPLIST_2,FN_MAPLIST}
&ADDEM [v(dbref_bbpocket)]=add(%0,%1)
&B36_DIGITS [v(dbref_bbpocket)]=0 1 2 3 4 5 6 7 8 9 A B C D E F G H I J K L M N O P Q R S T U V W X Y Z
&B36_POWS [v(dbref_bbpocket)]=1 36 1296 46656 1679616 60466176
&FN_B36_MAGS [v(dbref_bbpocket)]=revwords(iter(v(b36_pows),switch([div(##,%0)]:[eq(##,%0)],0:*,##,*:1,##)))
&FN_B36-TO-B10 [v(dbref_bbpocket)]=[setq(0,ucstr(%0))][setq(1,strlen(%q0))][fold(me/addem,[iter(lnum(%q1),mul(sub(member(v(b36_digits),mid(%q0,##,1)),1),power(36,sub(sub(%q1,##),1))))],0)]
&FN_B10-TO-B36 [v(dbref_bbpocket)]=[setq(0,%0)][edit(iter(u(fn_b36_mags,%q0),[extract(v(b36_digits),add(div(%q0,##),1),1)][setq(0,sub(%q0,mul(##,div(%q0,##))))]),%b,)]
&FN_SORT_B36 [v(dbref_bbpocket)]=[iter(lnum(1,9),setq(##,))][trim([iter(%0,[setq(R,strlen(##))][setq(%qR,[r(%qR)] ##)])][iter(lnum(1,9),sort(r(##)))])]
@pemit me=[space(strlen(BBS INSTALLER>))] (25%% done)
&DO_COLOR [v(dbref_bbpocket)]=1
&C   [v(dbref_bbpocket)]=ifelse(v(DO_COLOR),ulocal(C_%0,%1),%1)
&C   [v(dbref_bbpocket)]=switch([v(DO_COLOR)]:[hasattr(%#,_C_%0)],1:1,ulocal(%#/_C_%0,%1),1:0,ulocal(C_%0,%1),%1)
&C_THEME [v(dbref_bbpocket)]=bright
&C_1 [v(dbref_bbpocket)]=ansi(bh,%0)
&C_2 [v(dbref_bbpocket)]=ansi(gh,%0)
&C_3 [v(dbref_bbpocket)]=ansi(ch,%0)
&C_STAFF   [v(dbref_bbpocket)]=ansi(mh,%0)
&C_UNREAD  [v(dbref_bbpocket)]=ansi(g,%0)
&C_TIMEOUT [v(dbref_bbpocket)]=ansi(y,%0)
&FN_COLOR_RHOSTMUSH [v(dbref_bbpocket)]=and(hasflag(%0,ANSI),hasflag(%0,ANSICOLOR))
&FN_COLOR_PENNMUSH [v(dbref_bbpocket)]=hasflag(%0,COLOR)
&FN_COLOR_MUX [v(dbref_bbpocket)]=hasflag(%0,ANSI)
&D_256FLAG_RHOSTMUSH [v(dbref_bbpocket)]=XTERMCOLOR
&D_256FLAG_PENNMUSH [v(dbref_bbpocket)]=XTERM256
&D_256FLAG_MUX [v(dbref_bbpocket)]=COLOR256
&FN_SET_FLAGS [v(dbref_bbpocket)]=The BBS has colors configured, but you're missing a flag for extended colors.  [ansi(hr,For best results type:)] [ansi(hc,@set me=[v(D_256FLAG_%0)])]
&FN_FLAGS_MSG [v(dbref_bbpocket)]=switch([setr(V,first(version()))]:[u(fn_color_%qV,%0)]:[hasflag(%0,v(d_256flag_%qV))],TinyMUSH:*:*,,*:1:1,,*:0:*,,*:1:0,u(FN_SET_FLAGS,%qV))
&FN_FLAGS_CHECK [v(dbref_bbpocket)]=ifelse(words(setr(M,ulocal(fn_flags_msg,%#))),%r[u(fn_bbprompt)] %qM,)
&FN_INC_NEXT_MESS [v(dbref_bbpocket)]=ulocal(fn_b10-to-b36,add(ulocal(fn_b36-to-b10,%0),1))
&VALID_CONFIGS [v(dbref_bbpocket)]=anonymous timeout
&VALID_GLOBAL_CONFIGS [v(dbref_bbpocket)]=color timeout autotimeout color_pri color_sec color_ter
&CONFIG_TIMEOUT [v(dbref_bbpocket)]=2592000
&TR_TIMEOUT [v(dbref_bbpocket)]=@dolist v(groups)={@trigger me/tr_timeout_group=##}
&TR_TIMEOUT_GROUP [v(dbref_bbpocket)]=@dolist ulocal(fn_mess_list_threaded,%0) = {@switch and(setr(S,extract(get(%0/hdr_##),5,1,|)),gt(secs(),%qS),not(hasattr(%0,reply_##)))=1,{&hdr_## %0;&bdy_## %0;@switch hasattr(%0,parent_##)=1,{th [setq(P,get(%0/parent_##))];&parent_## %0;&reply_%qP %0=[remove(get(%0/reply_%qP),##)];},{&mess_lst %0=[remove(get(%0/mess_lst),##)];};&master_lst #bbpocket=[remove(v(master_lst),##)]}}
&DO_TIMEOUTS [v(dbref_bbpocket)]=@trigger me/tr_timeout; @wait 86400={@trigger me/do_timeouts}
&TR_CONFIG_ANONYMOUS [v(dbref_bbpocket)]=&anonymous %0=[ifelse(t([%1]),[%1],)]; @pemit %2=Posters on the [name(%0)] group will show up as [ifelse(t([%1]),['%1'],themselves)].
&TR_CONFIG_TIMEOUT [v(dbref_bbpocket)]=&config_timeout %0=[mul(%1,86400)]; @pemit %2=New messages for group '[name(%0)]' have [ifelse(%1,a %1 day,no)] timeout.
&TR_GCONFIG_COLOR [v(dbref_bbpocket)]=&do_color me=[switch(lcstr(%0),yes,1,true,1,on,1,1,1,0)];@pemit %1=BBS is [ifelse(v(do_color),now,no longer)] using color.
&TR_GCONFIG_TIMEOUT [v(dbref_bbpocket)]=&config_timeout me=[mul(%0,86400)]; @pemit %1=BB global config parameter 'timeout': [ifelse(%0,%0 days,none)].%rAny new groups will have this value set as their default timeout.
&TR_GCONFIG_AUTOTIMEOUT [v(dbref_bbpocket)]=@switch [eq(hasattr(me,startup),setr(0,switch(%0,on,1,0)))]:%0=1:*,{@pemit %1=BB autotimeout is already [ifelse(%q0,on,off)].},0:on,{@startup me=@trigger me/do_timeouts; @trigger me/do_timeouts; @pemit %1=BB autotimeout turned on.},{@startup me; @pemit %1=BB autotimeout turned off.; @halt me}
&FN_MSG_FLAGS [v(dbref_bbpocket)]=switch([member(get(%0/bb_read),%2)]:[u(fn_timeout_close,index(get(%1/hdr_%2),|,5,1))],0:*,[u(c,unread,U)],*:1,[u(c,timeout,T)])
&TR_POST_NOTIFY [v(dbref_bbpocket)]=@switch hasflag(%0,DARK)=0,{@pemit/list iter(remove(lwho(),%0),switch(or(member([get(##/bb_omit)] [get(##/bb_silent)],%1),not(u(%1/canread,##))),0,##))=[u(fn_bbprompt)] New BB message ([member(v(groups),%1)]/%2) posted to '[name(%1)]' by [ifelse(hasattr(%1,anonymous),get(%1/anonymous),name(%0))]: %3}
&FN_TIMEOUT_CLOSE [v(dbref_bbpocket)]=switch(%0:[lte(sub(%0,secs()),259200)],0:*,0,*:1,1,0)
&FN_HASCONFIG [v(dbref_bbpocket)]=or(hasattr(%0,anonymous),neq(get(%0/config_timeout),get(#bbpocket/config_timeout)))
&FN_BORDER [v(dbref_bbpocket)]=u(c,1,repeat(=,%0))
&FN_LINE   [v(dbref_bbpocket)]=u(c,1,repeat(-,%0))
&FN_BBPROMPT [v(dbref_bbpocket)]=[u(c,3,BBS)][u(c,2,:)]
&FN_BNAME [v(dbref_bbpocket)]=ifelse(u(fn_bbs_staff,ifelse(isdbref(%0),%0,*%0)),u(c,staff,ifelse(isdbref(%0),name(%0),%0)),ifelse(isdbref(%0),name(%0),%0))
&FN_CENT [v(dbref_bbpocket)]=[setq(D,div(setr(S,sub(%1,add(strlen(%0),2))),2))][switch(add(%qD,%qD),%qS,%qD:%qD,[add(%qD,1)]:%qD)]
&FN_BORDER_CENT [v(dbref_bbpocket)]=[setq(F,ulocal(fn_cent,%0,%1))][u(fn_border,first(%qF,:))] [u(c,2,%0)] [u(fn_border,rest(%qF,:))]
&FN_LINE_CENT [v(dbref_bbpocket)]=[setq(F,ulocal(fn_cent,%0,%1))][u(fn_line,first(%qF,:))] [u(c,2,%0)] [u(fn_line,rest(%qF,:))]
&FN_ID [v(dbref_bbpocket)]=[ifelse(strmatch(%0,*/*),[setq(B,first(%0,/))][setq(B,ifelse(isdbref(%qB),%qB,ulocal(GET_GROUP,%qB)))][setq(M,rest(%0,/))][ifelse(words(setr(I,ulocal(fn_id_by_ord,%qB,%qM))),%qB:%qI,)],[first(iter(v(GROUPS),ifelse(member(ulocal(fn_mess_list_threaded,##),%0),##:%0,)))])]
&FN_ID_BY_ORD [v(dbref_bbpocket)]=[setq(I,first(%1,.))][ifelse(isnum(%qI),[setq(B,ifelse(isdbref(%0),%0,ulocal(GET_GROUP,%0)))][setq(P,extract(get(%qB/MESS_LST),%qI,1))][ifelse(strmatch(%1,*.*),[extract(get(%qB/REPLY_%qP),rest(%1,.),1)],%qP)],)]
&FN_ORD_BY_ID [v(dbref_bbpocket)]=ifelse(setr(P,member(get(%0/mess_lst),%1)),%qP,[member(get(%0/mess_lst),setr(P,get(%0/parent_%1)))].[member(get(%0/reply_%qP),%1)])
&FN_IS_VALID_ID [v(dbref_bbpocket)]=switch(words(rest(ulocal(fn_id,%0/%1),:)),0,0,1)
&FN_MSG_old [v(dbref_bbpocket)]=[ifelse(strmatch(%0,*/*),[setq(C,first(%0,/))][setq(B,extract(v(GROUPS),%qC,1))][setq(N,rest(%0,/))][setq(I,rest(ulocal(fn_id,%qB/%qN),:))],[setq(0,ucstr(%0))][setq(L,trim(ulocal(fn_id,%q0)))][setq(B,first(%qL,:))][setq(I,rest(%qL,:))][setq(C,member(v(GROUPS),%qB))][setq(N,ulocal(fn_ord_by_id,%qB,%qI))])][setq(H,get(%qB/HDR_%qI))][setq(T,ulocal(bbtime_view_details,index(%qH,|,2,1)))]%r[u(fn_border_cent,name(%qB),78)]%r[ljust(Message: %qC/%qN[switch(ulocal(fn_timeout_close,index(%qH,|,5,1)),1,{%b(timeout warning)})],35)]Author[rjust(ldelete(%qT,4),37)][setq(W,0)][iter(index(%qH,|,1,1),switch(%qW:[gte(add(strlen(%qY),strlen(%b##)),36)],1:*,setq(Z,%qZ ##),0:1,[setq(W,1)][setq(Z,##)],setq(Y,%qY ##)))]%r[ljust(u(c,3,trim(%qY)),35)][ljust(mid([u(fn_bname,index(%qH,|,3,1))][ifelse(and(hasattr(%qB,anonymous),u(fn_bbs_staff,%#)),%b\([u(fn_bname,index(%qH,|,4,1))]\),)],0,29),35)][elements(%qT,4)]%r[ifelse(strlen(%qZ),[u(c,3,%qZ)]%r,)][u(fn_line,78)]%r[get(%qB/BDY_%qI)]%r[u(fn_border,78)]
&FN_MSG [v(dbref_bbpocket)]=[ifelse(strmatch(%0,*/*),[setq(C,first(%0,/))][setq(B,extract(v(GROUPS),%qC,1))][setq(N,rest(%0,/))][setq(I,rest(ulocal(fn_id,%qB/%qN),:))],[setq(0,ucstr(%0))][setq(L,trim(ulocal(fn_id,%q0)))][setq(B,first(%qL,:))][setq(I,rest(%qL,:))][setq(C,member(v(GROUPS),%qB))][setq(N,ulocal(fn_ord_by_id,%qB,%qI))])][setq(H,get(%qB/HDR_%qI))][setq(T,ulocal(bbtime_view_details,index(%qH,|,2,1)))]%r[u(fn_border_cent,name(%qB),78)]%rMessage: %qC/%qN[setq(W,sub(78,add(strlen(Message: %qC/%qN),strlen(ldelete(%qT,4)))))][center(Author: [mid([u(fn_bname,index(%qH,|,3,1))][ifelse(and(hasattr(%qB,anonymous),u(fn_bbs_staff,%#)),%b\([u(fn_bname,index(%qH,|,4,1))]\),)],0,sub(%qW,4))],%qW)][ldelete(%qT,4)]%r[ljust(u(c,3,mid(u(fn_message_subject,%qH),0,64)),70)][elements(%qT,4)]%r[switch(ulocal(fn_timeout_close,index(%qH,|,5,1)),1,u(fn_line_cent,{(timeout warning)},78),u(fn_line,78))]%r[get(%qB/BDY_%qI)]%r[u(fn_border,78)]
@switch/first version()=Tiny*,  { &fn_bbs_staff [v(dbref_bbpocket)]=hasflag\(\%0,wizard) },Penn*,  { &fn_bbs_staff [v(dbref_bbpocket)]=hasflag\(\%0,wizard) },MUX*,   { &fn_bbs_staff [v(dbref_bbpocket)]=gte\(bittype\(\%0),5) },Rhost*, { &fn_bbs_staff [v(dbref_bbpocket)]=gte\(bittype\(\%0),5) }
@pemit me=[space(strlen(BBS INSTALLER>))] (50%% done -- if the install was fast, it might slow down at this point)
@force me={@cpattr me/_myrbb_version=[v(dbref_bbpocket)]; &_myrbb_version me}
@set [v(dbref_bbpocket)]=!HALT
@set [v(dbref_bbpocket)]=INHERIT
@set [v(dbref_bbpocket)]=SAFE
@switch/first first(version())=Rhost*,{&BUFFER_SIZE [v(dbref_bbpocket)]=[sub(config(lbuf_size),2)]},{&BUFFER_SIZE [v(dbref_bbpocket)]=[strlen(repeat(x,999999))]}
@wait 0={@pemit %#=BBS INSTALLER> buffer_size: [get([v(dbref_bbpocket)]/buffer_size)]}
@lock [v(dbref_bbs)]=me
@Desc [v(dbref_bbs)]=[iter(setdiff(lattr(me),Desc),ljust(##,18))]
@Fail [v(dbref_bbs)]=It's bolted down... you aint budgin' it.
@force me={@parent [v(dbref_bbs)]=[v(dbref_bbpocket)]}
&CMD_+BBNEWGROUP [v(dbref_bbs)]=$+bbnewgroup *:@switch u(fn_bbs_staff,%#)=1, {@create %0; @wait 1={@switch [setr(0,num(%0))]=#-1,{@pemit %#=[u(fn_bbprompt)] That's not a good name for a group.},{&groups #bbpocket=[switch(words(get(#bbpocket/groups)),0,,[get(#bbpocket/groups)]%b)]%q0; &own %q0=%#; @set %q0=safe; @set %q0=inherit; &last_mod %q0=[u(#bbpocket/bbtime)]; &CANREAD %q0=1; &CANWRITE %q0=1; &config_timeout %q0=[get(#bbpocket/config_timeout)]; @pemit %#=[u(fn_bbprompt)] Group number [member(get(#bbpocket/groups),%q0)] added as '%0'. Messages will have [ifelse(get(%q0/config_timeout),a [div(get(%q0/config_timeout),86400)] day,no)] timeout.}}}, {@pemit %#=[u(fn_bbprompt)] You can't add groups to the message base.}
&CMD_+BBLOCK [v(dbref_bbs)]=$+bblock *=*/*:@switch u(fn_bbs_staff,%#)=1,{@switch member(get(#bbpocket/groups),setr(0,u(#bbpocket/get_group,%0)))=0,{@pemit %#=[u(fn_bbprompt)] No such group as '%0'.},{@switch %1=flag,{&CANREAD %q0=\[or(hasflag(\%0,%2),u(fn_bbs_staff,\%0))]},{&CANREAD %q0=\[or(match(get(\%0/%1),%2),u(fn_bbs_staff,\%0))]};@wait 1={&CANWRITE %q0=[get(%q0/CANREAD)]};@pemit %#=[u(fn_bbprompt)] Group '%0' locked. Only people with %1=%2 can access.}},{@pemit %#=You cannot lock message groups.}
&CMD_+BBLOCK [v(dbref_bbs)]=$+bblock *=*/*:@switch/first [u(fn_bbs_staff,%#)]:[member(get(#bbpocket/groups),setr(0,u(#bbpocket/get_group,%0)))]:%1=0:*:*,{@pemit %#=[u(fn_bbprompt)] You cannot lock message groups.},1:0:*,{@pemit %#=[u(fn_bbprompt)] No such group '%0'.},1:*:flag,{&CANREAD %q0=\[or(hasflag(\%0,%2),u(#bbpocket/fn_bbs_staff,\%0))];&CANWRITE %q0=[get(%q0/CANREAD)];@pemit %#=[u(fn_bbprompt)] Group '%0' locked. Only people with %1=%2 can access.},{&CANREAD %q0=\[or(match(get(\%0/%1),%2),u(#bbpocket/fn_bbs_staff,\%0))];&CANWRITE %q0=[get(%q0/CANREAD)];@pemit %#=[u(fn_bbprompt)] Group '%0' locked. Only people with %1=%2 can access.}
&TR_CLEANUP_CLEARGROUP [v(dbref_bbpocket)]=@switch v(delete_grp)=%0,{&delete_grp #bbpocket; @pemit [u(fn_bbprompt)] %1=[u(c,3,BBS:)] Group '[u(c,2,name(%0))]' no longer marked for deletion.}
&CMD_+BBCLEARGROUP [v(dbref_bbs)]=$+bbcleargroup *:@switch and(u(fn_bbs_staff,%#),member(v(groups),setr(0,u(get_group,%0))))=1,{&delete_grp #bbpocket=%q0;@wait 30={@trigger #bbpocket/TR_CLEANUP_CLEARGROUP=%q0,%#};@pemit %#=%r[space(15)][ansi(rh,********)] [ansi(yh,Warning)] [ansi(rh,********)]%r%rDeleting Group #%0 ([u(c,2,name(%q0))]) will also delete the [words(ulocal(fn_mess_list_threaded,%q0))] messages in that group.%rIf you still wish to proceed, type '[ansi(h,+bbconfirm %0)]'%rOtherwise, this action will be cancelled in 30 seconds.%r%r[space(15)][ansi(rh,repeat(*,25))]%r},{&delete_grp #bbpocket;@pemit %#=[u(fn_bbprompt)] You can't remove that group (either that group does not exist, or you are not the owner).}
&DO_CLEARGROUP [v(dbref_bbs)]=$+bbconfirm *:@switch v(DELETE_GRP)=[setr(0,u(get_group,%0))],{&groups #bbpocket=[remove(v(groups),%q0)];&master_lst #bbpocket=[setdiff(v(master_lst),ulocal(fn_mess_list_threaded,%q0))];th [setq(N,name(%q0))];@nuke %q0;&delete_grp #bbpocket;@pemit %#=[u(fn_bbprompt)] Group number %0 ([u(c,2,%qN)]) removed.},{&delete_grp #bbpocket;@pemit %#=[u(fn_bbprompt)] That group has not been marked for deletion. Use '+bbcleargroup <#>' to mark a group for deletion.}
&CMD_+BBPOST [v(dbref_bbs)]=$+bbpost */*=*:@switch member(u(valid_groups,%#,write),setr(0,u(get_group,%0)))=0,{@pemit %#=[u(fn_bbprompt)] Either you do not subscribe to Group #%0, or are unable to post to it.},{&mess_lst %q0=[cat(get(%q0/mess_lst),setr(1,v(nxt_mess)))];&nxt_mess #bbpocket=[ulocal(fn_inc_next_mess,%q1)];&master_lst #bbpocket=[cat(v(master_lst),%q1)];&hdr_%q1 %q0=[edit(mid(%1, 0, 64),|,__PIPE__)]|[u(bbtime)]|[edefault(%q0/anonymous,mid(name(%#),0,24))]|[owner(%#)]|[ifelse(get(%q0/config_timeout),add(get(%q0/config_timeout),secs()),0)];&last_mod %q0=[u(bbtime)];&bdy_%q1 %q0=[%2][ifelse(and(hasattr(%#,bb_sig),not(hasattr(%q0,anonymous))),{%r[objeval(%#,eval(%#,bb_sig))]},)];@pemit %#=[u(fn_bbprompt)] You post your note about '%1' in group [member(get(#bbpocket/groups),%q0)] ([name(%q0)]) as message #[member(get(%q0/mess_lst),%q1)][ifelse(and(hasattr(%#,bb_sig),hasattr(%q0,anonymous)),{%b%bThis is an anonymous group, your BB_SIG was -not- appended.},)];&bb_read %#=[setunion(get(%#/bb_read),%q1)];@trigger #bbpocket/tr_post_notify=%#,%q0,[member(get(%q0/mess_lst),%q1)],[mid(%1, 0, 34)]}
&CMD_+BBREMOVE [v(dbref_bbs)]=$+bbremove */*:th [setq(0,u(get_group,%0))][setq(L,revwords(sort(ulocal(fn_ids_and_replies,%q0,ulocal(fn_makelist,%1)))))];@switch words(%qL)=0,{@pemit %#=[u(fn_bbprompt)] No such message %0/%1},{@dolist [setq(0,u(get_group,%0))][revwords(sort(ulocal(fn_ids_and_replies,%q0,ulocal(fn_makelist,%1))))]={@switch or(strmatch(index(get(%q0/HDR_##),|,4, 1),%#), ulocal(fn_bbs_staff,%#))=1,{@pemit %#=[u(fn_bbprompt)] Message [u(fn_ord_by_id,%q0,##)] removed from group #[member(v(groups),%q0)] ([name(%q0)]).;&HDR_## %q0;&BDY_## %q0;&MESS_LST %q0=[remove(get(%q0/MESS_LST),##)];&MASTER_LST #bbpocket=[remove(v(MASTER_LST),##)];@switch hasattr(%q0,parent_##)=1,{th [setq(P,get(%q0/parent_##))];&REPLY_%qP %q0=[remove(get(%q0/REPLY_%qP),##)];&PARENT_## %q0}},{@pemit %#=[u(fn_bbprompt)] Either message [u(fn_ord_by_id,%q0,##)] does not exist, or you were not the original poster.}}}
&FN_MESS_LIST_THREADED [v(dbref_bbpocket)]=iter(get(%0/MESS_LST),##[ifelse(hasattr(%0,reply_##),%b[get(%0/reply_##)],)])
&FN_IDS_AND_REPLIES [v(dbref_bbpocket)]=[iter(%1,ifelse(strmatch(##,*.*),ulocal(fn_id_by_ord,%0,##),[setr(I,extract(get(%0/mess_lst),##,1))]%b[get(%0/REPLY_%qI)]))]
&FN_ID_LIST [v(dbref_bbpocket)]=iter(%1,ifelse(strmatch(##,*.*),extract(get(%0/REPLY_[extract(get(%0/MESS_LT),##,1)]),rest(##,.),1),extract(get(%0/MESS_LST),##,1)))
&FN_ID_LIST_FROM_RANGE [v(dbref_bbpocket)]=iter(%1,ifelse(strmatch(##,*-*),[setq(B,first(##,-))][setq(E,rest(##,-))][setq(L,iter(lnum(%qB,%qE),[setr(I,ulocal(fn_id_by_ord,%0,%i0))] [get(%0/reply_%qI)]))][ifelse(strmatch(%qB,*.*),[setq(L,remove(%qL,[setr(I,ulocal(fn_id_by_ord,%0,first(%qB,.)))] [extract(get(%0/reply_%qI),1,sub(rest(%qB,.),1))]))],)][ifelse(strmatch(%qE,*.*),[setq(L,remove(%qL,[setq(I,ulocal(fn_id_by_ord,%0,first(%qE,.)))] [extract(get(%0/reply_%qI),add(rest(%qE,.),1),words(get(%0/reply_%qI)))]))],)]%qL,[setr(I,ulocal(fn_id_by_ord,%0,first(##,*)))] [switch(words(##,*),1,,get(%0/reply_%qI))]))
&D_NO_MESSAGES [v(dbref_bbpocket)]=(No messages)
&CMD_+BBREAD2_OLD [v(dbref_bbs)]=$+bbreadold *:@switch strmatch([%0],*/*)=0,{@switch member(u(valid_groups,%#,read),setr(0,u(get_group,%0)))=0,{@pemit %#=[u(fn_bbprompt)] [switch(%q0,#-2,That Group name is not specific enough.,You do not subscribe to that Group.)]},{@pemit %#=[u(fn_border,78)]%r[u(c,2,center(**** [name(%q0)] ****,78))]%r[space(11)]Message[space(28)]Posted[space(13)]By%r[u(fn_line,78)];@switch words(setr(L,ulocal(fn_mess_list_threaded,%q0)))=0,{@pemit %#=%r[center(v(d_no_messages),78)]%r%r[u(fn_line,78)]},{@dolist ulocal(fn_mess_list_threaded,%q0)={@pemit %#=[ljust([u(c,3,[member(v(groups),%q0)]/[ifelse(hasattr(%q0,parent_##),[member(get(%q0/MESS_LST),setr(P,get(%q0/parent_##)))].[member(get(%q0/reply_%qP),##)],[member(get(%q0/MESS_LST),##)])])],9)][ljust(u(fn_msg_flags,%#,%q0,##),2)][ifelse(hasattr(%q0,parent_##),[setq(R,get(%q0/reply_[get(%q0/parent_##)]))][setq(S,32)]%b[u(c,2,switch(member(%qR,##),words(%qR),`,|))]%b,setq(S,35))][ljust(left(index(setr(1,get(%q0/HDR_##)),|,1,1),sub(%qS,1)),%qS)][ljust(u(bbtime_view,index(%q1,|,2,1)),19)][mid([u(fn_bname,index(%q1,|,3,1))][ifelse(and(hasattr(%q0,anonymous),u(fn_bbs_staff,%#)),%b\([u(fn_bname,index(%q1,|,4,1))]\),)],0,21)][switch(member(%qL,##),words(%qL),%r[u(fn_border,78)])]}}}},{@switch member(u(valid_groups,%#,read),setr(0,u(get_group,setr(2,first(%0,/)))))=0,{@pemit %#=[u(fn_bbprompt)] [switch(%q0,#-2,That Group name is not specific enough.,You do not subscribe to that Group.)]},{th [setq(L,switch(rest(%0,/),u,[ulocal(fn_unreadids,%#,%q0)],[ulocal(fn_id_list_from_range,%q0,rest(%0,/))]))];@switch words(%qL)=0,{@pemit %#=[u(fn_bbprompt)] Invalid message list for group '[name(%q0)]'},{@dolist %qL={@pemit %#=[ulocal(fn_msg_old,##)];&bb_read %#=[setunion(get(%#/bb_read),##)];};};@wait 2={&bb_read %#=[setinter(get(%#/bb_read),v(master_lst))]}}}
&CMD_+BBREAD2 [v(dbref_bbs)]=$+bbread *:th setq(0,secure({%0}));@switch strmatch([%q0],*/*)=0,{@switch member(u(valid_groups,%#,read),setr(G,u(get_group,%q0)))=0,{@pemit %#=[u(fn_bbprompt)] [switch(%qG,#-2,That Group name is not specific enough.,You do not subscribe to that Group.)]},{@pemit %#=[u(fn_border,78)]%r[u(c,2,center(**** [name(%qG)] ****,78))]%r[space(11)]Message[space(28)]Posted[space(13)]By%r[u(fn_line,78)];@switch words(setr(L,ulocal(fn_mess_list_threaded,%qG)))=0,{@pemit %#=%r[center(v(d_no_messages),78)]%r%r[u(fn_line,78)]},{@dolist %qL={@pemit %#=[ulocal(fn_message_listing,%#,%qG,##)][switch(member(%qL,##),words(%qL),%r[u(fn_border,78)])];}}}},{@switch member(u(valid_groups,%#,read),setr(G,u(get_group,setr(2,first(%q0,/)))))=0,{@pemit %#=[u(fn_bbprompt)] [switch(%qG,#-2,That Group name is not specific enough.,You do not subscribe to that Group.)]},{th [setq(L,switch(rest(%q0,/),u,[ulocal(fn_unreadids,%#,%qG)],[ulocal(fn_id_list_from_range,%qG,rest(%q0,/))]))];@switch/first [words(%qL)]:[rest(%q0,/)]=0:u,{@pemit %#=[u(fn_bbprompt)] There are no unread messages in group '[name(%qG)]'},0:*,{@pemit %#=[u(fn_bbprompt)] Invalid message list for group '[name(%qG)]'},{@dolist %qL={@pemit %#=[ulocal(fn_msg,##)];&bb_read %#=[setunion(get(%#/bb_read),##)];};};@wait 2={&bb_read %#=[setinter(get(%#/bb_read),v(master_lst))]}}}
&CMD_+BBNEW0 [v(dbref_bbs)]=$+bbnew:@switch/first words(setdiff(u(fn_readable_ids,%#),get(%#/bb_read)))=0,{@pemit %#=[u(fn_bbprompt)] No unread messages.},{@pemit %#=[u(fn_border,7)]%r[u(c,2,center(**** Unread Postings ****,78))]%r[space(11)]Message[space(28)]Posted[space(13)]By;th [setq(G,ulocal(valid_groups,%#,read))][setq(Z,last(%qG))];@dolist %qG={@switch t(setr(L,ulocal(fn_sort_b36,ulocal(fn_unreadids,%#,setr(B,##)))))=1,{th setq(W,words(%qL));@pemit %#=[ulocal(fn_line_cent,[name(%qB)],78)];@pemit %#=[trim(iter(extract(%qL,1,div(%qW,2)),pemit(%#,ulocal(fn_message_listing,%#,%qB,itext(0)))))];@pemit %#=[trim(iter(extract(%qL,add(1,div(%qW,2)),%qW),pemit(%#,ulocal(fn_message_listing,%#,%qB,itext(0)))))]};@switch %qZ=%qB,{@pemit %#=[u(fn_line,78)]}}}
&CMD_+BBNEW [v(dbref_bbs)]=$+bbnew *:@switch [member(u(valid_groups,%#,read),setr(0,u(get_group,%0)))]:[words(setr(L,ulocal(fn_sort_b36,ulocal(fn_unreadids,%#,%q0))))]=0:*,{@pemit %#=[u(fn_bbprompt)] [switch(%q0,#-2,That Group name is not specific enough.,You do not subscribe to that Group.)]},*:0,{@pemit %#=[u(fn_bbprompt)] There are no unread messages in [name(%q0)]},{@pemit %#=[u(fn_border,78)]%r[u(c,2,center(**** [name(%q0)] ****,78))]%r[space(11)]Message[space(28)]Posted[space(13)]By%r[u(fn_line,78)];@dolist %qL={@pemit %#=[ulocal(fn_message_listing,%#,%q0,##)][switch(member(%qL,##),words(%qL),%r[u(fn_border,78)])];}}
&CMD_+BBEDIT [v(dbref_bbs)]=$+bbedit */*=*/*:@switch strmatch(index(get([setr(B,u(get_group,%0))]/HDR_[setr(I,u(fn_id_by_ord,%qB,%1))]),|,4, 1),%#)=1,{&BDY_%qI %qB=[edit(get(%qB/BDY_%qI),{%2},{%3})];@pemit %#=[u(fn_border,78)]%rMessage [member(v(groups),%qB)]/%1 ([name(%qB)]/%1) now reads:%r[u(fn_line,78)]%r[get(%qB/BDY_%qI)]%r[u(fn_border,78)]},{@pemit %#=[u(fn_bbprompt)] Either that message does not exist, or you were not the original poster.}
&CMD_+BBLEAVE [v(dbref_bbs)]=$+bbleave *:@switch member(u(#bbpocket/valid_groups,%#,read),[setq(0,u(#bbpocket/get_group,%0))]%q0)=0,{@pemit %#=[u(fn_bbprompt)] You aren't currently subscribing to Board #%0. No ommission necessary.},{&bb_omit %#=[setunion(get(%#/bb_omit),%q0)]; @pemit %#=[u(fn_bbprompt)] You have removed yourself from the [name(%q0)] board.}
&CMD_+BBJOIN [v(dbref_bbs)]=$+bbjoin *:@switch member(NULL [get(%#/bb_omit)],[setq(0,u(#bbpocket/get_group,%0))]%q0)=0,{@pemit %#=[u(fn_bbprompt)] [switch(member(u(#bbpocket/valid_groups,%#,read),%q0),0,{Sorry, you don't have access to that board.},{You are already a member of the [name(%q0)] board.})]},{&bb_omit %#=[setdiff(get(%#/bb_omit),%q0)]; @pemit %#=[u(fn_bbprompt)] You have joined the [name(%q0)] board.}
&D_CAP [v(dbref_bbpocket)]=% capacity
&D_PZERO [v(dbref_bbpocket)]=\%0
&CMD_+BBSCAN [v(dbref_bbs)]=$+bbscan:@pemit %#=[switch(hasattr(#bbpocket,BB_POST_HDR_%#),1,** BB Warning: You are in the middle of writing a bbpost. **%r)][switch(setdiff(iter(setr(0,u(VALID_GROUPS,%#,read)),ulocal(fn_mess_list_threaded,##)),setr(1,get(%#/BB_READ))),,[u(fn_bbprompt)] There are no unread postings on the Global Bulletin Board.,[u(fn_line_cent,Unread Postings on the Global Bulletin Board,78)][setq(9,v(GROUPS))][trim(iter(%q0,switch(setr(2,setdiff(setr(L,ulocal(fn_mess_list_threaded,##)),%q1)),,,%r[u(c,3,name(##))] \(#[member(%q9,##)]\): [words(%q2)] unread \([u(#bbpocket/FN_UNREAD_LIST,%q2,%qL,##)]\))),b)]%r[u(fn_line_cent,BBS at [round(mul(fdiv(strlen(v(MASTER_LST)),v(BUFFER_SIZE)),100),1)][v(d_cap)],78)])][ulocal(fn_flags_check,%#)];@pemit %#=[u(fn_bbprompt)] [u(c,2,HINT:)] You can reply directly to a BB posting with +bbreply (eg. '+bbreply 1/3')
&CMD_+BBLIST [v(dbref_bbs)]=$+bblist:@pemit %#=[u(fn_border,78)]%r[ljust(Available Bulletin Board Groups,37)]Member?[space(8)]Timeout (in days)%r[u(fn_line,78)]%b[iter(v(groups),switch(u(##/canread,%#),1,{%r%b[trim([ljust(member(v(groups),##),5)][ljust(u(c,3,name(##)),32)][ljust(switch(member(get(%#/bb_omit),##),0,Yes,No),19)][rjust(ifelse(get(##/config_timeout),div(get(##/config_timeout),86400),none),4)])]}))]%r[u(fn_line,78)]%rTo join groups, type '+bbjoin <group number or name>'%r[u(fn_border,78)]
&CREDITS [v(dbref_bbs)]=Myrddin's BBS was written by Myrddin@everywhere (Elysium, Dreaming, etc). (email: merlin@firstmagic.com). The most recent version of this code can be found at http://www.firstmagi.com.  I hope you continue to get good use out of it! :)
@set [v(dbref_bbs)]/CREDITS = no_command
&CMD_+BBCATCHUP [v(dbref_bbs)]=$+bbcatchup *:@switch lcstr(%0)=all,{&bb_read %#=[v(master_lst)];@pemit %#=[u(fn_bbprompt)] All postings on all boards marked as read.},{@dolist [setq(1,u(valid_groups,%#,read))][u(fn_makelist,%0)]={@switch member(%q1,[setq(0,u(get_group,##))]%q0)=0,{@pemit %#=[u(fn_bbprompt)] You do not subscribe to Group ##.},{&bb_read %#=[setunion(get(%#/bb_read),ulocal(fn_mess_list_threaded,%q0))];@pemit %#=[u(fn_bbprompt)] All postings on Group #[member(v(groups),%q0)] ([name(%q0)]) marked as read.}}}
&CMD_+BBMOVE [v(dbref_bbs)]=$+bbmove */* to *:@switch and(member(u(valid_groups,%#,read),[setq(0,u(get_group,%0))]%q0),member(u(valid_groups,%#,write),[setq(2,u(get_group,%2))]%q2),not(strmatch(%q0,%q2)))=0,{@pemit %#=[u(fn_bbprompt)] One of the selected groups is not valid (either it doesn't exist, you can't write to it, or you tried to 'move' to the same group).},{th [setq(U,u(fn_id,%0/%1))][setq(B,first(%qU,:))][setq(I,rest(%qU,:))];@switch or(strmatch(index(get(%qB/HDR_%qI),|,4, 1),%#),and(u(fn_bbs_staff,%#),member(ulocal(fn_mess_list_threaded,%qB),%qI)))=1,{&HDR_%qI %q2=[get(%qB/HDR_%qI)];&BDY_%qI %q2=[get(%qB/BDY_%qI)];&MESS_LST %q2=[cat(get(%q2/mess_lst),%qI)];&MESS_LST %qB=[remove(get(%qB/MESS_LST),%qI)];&HDR_%qI %qB;&BDY_%qI %qB;@switch [hasattr(%qB,PARENT_%qI)]:[hasattr(%qB,REPLY_%qI)]=1:*,{&REPLY_[setr(P,get(%qB/PARENT_%qI))] %qB=[remove(get(%qB/REPLY_%qP),%qI)];&PARENT_%qI %qB},0:1,{th [setq(R,get(%qB/REPLY_%qI))];@dolist %qR={&HDR_## %q2=[get(%qB/HDR_##)];&BDY_## %q2=[get(%qB/BDY_##)];&HDR_## %qB;&BDY_## %qB;&PARENT_## %q2=%qI};&REPLY_%qI %q2=%qR;&REPLY_%qI %qB};@pemit %#=[u(fn_bbprompt)] Message '%1' removed from group '%0' and added to group '%2' as message #[member(get(%q2/mess_lst),%qI)]},{@pemit %#=[u(fn_bbprompt)] Not a valid message number for that group.}}
&CMD_+BBWRITELOCK [v(dbref_bbs)]=$+bbwritelock *=*/*:@switch u(fn_bbs_staff,%#)=1,{@switch member(get(#bbpocket/groups),[setq(0,u(#bbpocket/get_group,%0))]%q0)=0,{@pemit %#=[u(fn_bbprompt)] No such group as '%0'.},{@switch %1=flag,{&CANWRITE %q0=\[or(u(fn_bbs_staff,\%0),u(fn_bbs_staff,\%0))]},{&CANWRITE %q0=\[or(match(get(\%0/%1),%2),u(fn_bbs_staff,\%0))]}; @pemit %#=[u(fn_bbprompt)] Group '%0' locked. Only people with %1=%2 can write.}},{@pemit %#=[u(fn_bbprompt)] You cannot lock message groups.}
&CMD_+BBPOST2 [v(dbref_bbs)]=$+bbpost */*:@switch hasattr(#bbpocket,bb_post_hdr_%#)=1,{@pemit %#=[u(fn_bbprompt)] You are already in the middle of writing a bbpost.},{@switch strmatch(%1,*=*)=0,{@switch member(u(valid_groups,%#,write),setr(0,u(get_group,%0)))=0,{@pemit %#=[u(fn_bbprompt)] Either you do not subscribe to Group #%0 or are unable to post to it.},{&bb_post_hdr_%# #bbpocket=%q0|[edit(mid(%1,0,64),|,__PIPE__)]|post;@pemit %#=%rYou start your posting to Group #[member(v(groups),%q0)] ([name(%q0)]).%rYou can now compose the body of the post by using '+bbwrite <text>'%ror '+bb <text>'.  When you are finished, type '+bbpost' by itself.[ifelse(and(hasattr(%#,bb_sig),hasattr(%q0,anonymous)),{%b%bThis is an anonymous group. Your BB_SIG will -not- be appended.},)]}}}
&CMD_+BBWRITE [v(dbref_bbs)]=$+bbwrite *:@switch hasattr(#bbpocket,bb_post_hdr_%#)=0,{@pemit %#=[u(fn_bbprompt)] You do not have a bbpost in progress.},{&bb_post_bdy_%# #bbpocket=[get(#bbpocket/bb_post_bdy_%#)]%0; @pemit %#=[u(fn_bbprompt)] Text added to bbpost.}
&CMD_+BBPROOF [v(dbref_bbs)]=$+bbproof:@switch hasattr(#bbpocket,bb_post_hdr_%#)=0,{@pemit %#=[u(fn_bbprompt)] You do not have a bbpost in progress.},{@pemit %#=[u(fn_border_cent,BB Post in Progress,78)]%rGroup: %b[name(index(get(#bbpocket/bb_post_hdr_%#),|,1,1))]%rTitle: %b[u(fn_message_subject,get(#bbpocket/bb_post_hdr_%#),2)]%r[u(fn_line,78)]%r[trim(get(#bbpocket/bb_post_bdy_%#))]%r[u(fn_border,78)]}
&CMD_+BBPOST-POST [v(dbref_bbs)]=$+bbpost:@switch [hasattr(#bbpocket,bb_post_hdr_%#)]:[hasattr(#bbpocket,bb_post_bdy_%#)]:[strmatch(index(v(bb_post_hdr_%#),|,3,1),reply)]=0:0:*,{@pemit %#=[u(fn_bbprompt)] You do not have a bbpost in progress.},1:0:*,{@pemit %#=[u(fn_bbprompt)] Your post is empty. Please add text with the '+bbwrite <text>' command or discard the posting with the '+bbtoss' command.},1:1:1,{th [setq(H,v(bb_post_hdr_%#))][setq(B,index(%qH,|,1,1))][setq(I,index(%qH,|,4,1))];@trigger #bbpocket/tr_post_reply=%qB,%qI,%#,v(bb_post_bdy_%#);&bb_post_bdy_%# #bbpocket;&bb_post_hdr_%# #bbpocket},{&mess_lst [setr(0,index(v(bb_post_hdr_%#),|,1,1))]=[cat(get(%q0/mess_lst),setr(1,v(nxt_mess)))];&nxt_mess #bbpocket=[ulocal(fn_inc_next_mess,%q1)];&master_lst #bbpocket=[cat(v(master_lst),%q1)];&hdr_%q1 %q0=[index(v(bb_post_hdr_%#),|,2,1)]|[u(bbtime)]|[edefault(%q0/anonymous,mid(name(%#),0,24))]|[owner(%#)]|[ifelse(get(%q0/config_timeout),add(get(%q0/config_timeout),secs()),0)];&last_mod %q0=[u(bbtime)];&bdy_%q1 %q0={[trim(v(bb_post_bdy_%#))][ifelse(and(hasattr(%#,bb_sig),not(hasattr(%q0,anonymous))),{%r[objeval(%#,eval(%#,bb_sig))]},)]};@pemit %#=[u(fn_bbprompt)] You post your note about '[setr(S,u(fn_message_subject,v(bb_post_hdr_%#),2))]' in group '[name(%q0)]' as message #[member(get(%q0/mess_lst),%q1)];&bb_read %#=[setunion(get(%#/bb_read),%q1)];@trigger #bbpocket/tr_post_notify=%#,%q0,[member(get(%q0/mess_lst),%q1)],%qS;&bb_post_bdy_%# #bbpocket;&bb_post_hdr_%# #bbpocket}
&CMD_+BBREAD [v(dbref_bbs)]=$+bbread:@pemit %#=[u(fn_border,78)]%r[space(7)]Group Name[space(20)]Last Post[space(11)]# of messages%r[u(fn_line,78)];@pemit %#=[trim(iter(u(valid_groups,%#,read),[pemit(%#,[rjust(member(v(groups),##),2)][center([switch([get(##/CANREAD)]:[get(##/CANWRITE)]:[u(##/CANWRITE,%#)],1:1:1,,1:*:1,{(-)},1:*:0,-,*)],5)][ljust(u(c,3,name(##)),30)][ljust(u(bbtime_view,get(##/LAST_MOD)),25)][rjust(words([setq(0,ulocal(fn_mess_list_threaded,##))]%q0),3)]%b[ljust(u(isgroupread,%#,%q0),2)])]))][u(fn_line,78)]%r[center('*' = restricted[space(5)]'-' = read only[space(5)]'\(-\)' = read only\, but you can write,78)]%r[setq(M,ifelse(u(fn_bbs_staff,%#),{BBS at [round(mul(fdiv(strlen(v(master_lst)),v(buffer_size)),100),1)][v(d_cap)]},))][ifelse(strlen(%qM),u(fn_border_cent,%qM,78),u(fn_border,78))]
&CMD_+BBTOSS [v(dbref_bbs)]=$+bbtoss:@switch hasattr(#bbpocket,bb_post_hdr_%#)=0,{@pemit %#=[u(fn_bbprompt)] You do not have bbpost in progress.},{&bb_post_hdr_%# #bbpocket;&bb_post_bdy_%# #bbpocket;@pemit %#=[u(fn_bbprompt)] Your bbpost has been discarded.}
&CMD_+BB [v(dbref_bbs)]=$+bb *:@switch hasattr(#bbpocket,bb_post_hdr_%#)=0,{@pemit %#=[u(fn_bbprompt)] You do not have a bbpost in progress.},{&bb_post_bdy_%# #bbpocket=[ifelse(hasattr(#bbpocket,bb_post_bdy_%#),[v(bb_post_bdy_%#)]%b,)]%0;@pemit %#=[u(fn_bbprompt)] Text added to bbpost.}
&CMD_+BBEDIT2 [v(dbref_bbs)]=$+bbedit *=*/*:@switch strmatch([setq(0,ucstr(%0))]%q0,*/*)=0,{@switch %q0=TEXT,{@edit #bbpocket/bb_post_bdy_%#={%1},{%2}},TITLE,{&bb_post_hdr_%# #bbpocket=[edit([index(setr(H,get(#bbpocket/bb_post_hdr_%#)),|,1,1)]|[edit(u(fn_message_subject,%qH,2),{%1},{%2})],|,__PIPE__)]};@wait 0={@pemit %#=[u(fn_border_cent,BB Post in Progress,78)]%rGroup: %b[name(index(setr(H,get(#bbpocket/bb_post_hdr_%#)),|,1,1))]%rTitle: %b[u(fn_message_subject,%qH,2)]%r[u(fn_line,78)]%r[trim(get(#bbpocket/bb_post_bdy_%#))]%r[u(fn_border,78)]}}
&CMD_+BBHELP [v(dbref_bbs)]=$+bbhelp:@pemit %#=[u(fn_bbprompt)] Please use '+help bb'.
&CMD_+BBCONFIG [v(dbref_bbs)]=$+bbconfig:@pemit %#=[u(fn_border_cent,Myrddin's Global BBS v[get(#bbpocket/version)],78)]%rGlobal Config Parameters:%r%r[rjust(color:,15)] [ifelse(v(do_color),yes,no)]%r[rjust(timeout:,15)] [div(get(#bbpocket/config_timeout),86400)] days%r[rjust(autotimeout:,15)] [ifelse(hasattr(#bbpocket,startup),on,off)]%r[u(fn_line,78)]%rBoard Config Parameters:%r%r%b[iter(filter(#bbpocket/fn_hasconfig,get(#bbpocket/groups)),%b%b[name(##)]%r[ifelse(hasattr(##,anonymous),[space(5)]anonymous: [get(##/anonymous)]%r,)][ifelse(neq(get(##/config_timeout),get(#bbpocket/config_timeout)),[space(5)]timeout: [ifelse(setr(T,div(get(##/config_timeout),86400)),u(c,timeout,%qT days),u(c,2,disabled))]%r,)]%r)][u(fn_border,78)]
&CMD_+BBCONFIG2 [v(dbref_bbs)]=$+bbconfig *=*:@switch [strmatch(%0,*/*)]:[u(n_bbs_staff,%#)]=1:*,{},0:0,{@pemit %#=Huh?%b%b(Type "help" for help.)},{@switch [member(v(valid_global_configs),lcstr(%0))]=0,{@pemit %#=[u(fn_bbprompt)] Valid global config parameters are: [v(valid_global_configs)]},{@trigger #bbpocket/tr_gconfig_%0=%1,%#}}
&CMD_+BBCONFIG3 [v(dbref_bbs)]=$+bbconfig */*=*:@switch/first [u(fn_bbs_staff,%#)]:[setr(0,u(#bbpocket/get_group,%0))]:[member(get(#bbpocket/valid_configs),lcstr(%1))]=0:*:*,{@pemit %#=Huh?%b%b(Type "help" for help.)},1:#-1:*,{@pemit %#=[u(fn_bbprompt)] '%0' is not a valid group name.},1:#-2:*,{@pemit %#=[u(fn_bbprompt)] '%0' is not specific enough.},1:*:0,{@pemit %#=[u(fn_bbprompt)] Valid config parameters are: [get(#bbpocket/valid_configs)]},{@trigger #bbpocket/tr_config_%1=%q0,%2,%#}
&CMD_+BBTIMEOUT [v(dbref_bbs)]=$+bbtimeout */*=*:@dolist [setq(0,u(#bbpocket/get_group,%0))][ulocal(fn_id_list_from_range,%q0,%1)]={@switch [or(strmatch(index(get(%q0/HDR_##),|,4, 1),%#),u(fn_bbs_staff,%#))]:[and(isnum(%2),or(and(gt(%2,0),lte(mul(%2,86400),get(%q0/config_timeout))),and(not(get(%q0/config_timeout)),gte(%2,0)),u(fn_bbs_staff,%#)))]=1:1,{&hdr_## %q0=[replace(get(%q0/hdr_##),5,ifelse(%2,add(secs(),mul(%2,86400)),0),|)];@pemit %#=[u(fn_bbprompt)] Message [u(fn_ord_by_id,%q0,##)] in group '[name(%q0)]' has [ifelse(%2,a %2 day,no)] timeout.},0:*,{@pemit %#=[u(fn_bbprompt)] Either message [u(fn_ord_by_id,%q0,##)] does not exist, or you were not the original poster.},*:0,{@pemit %#=[u(fn_bbprompt)] Sorry, '%2' is not a valid number of days for a timeout on the '[name(%q0)]' board. [ifelse(get(%q0/config_timeout),Maximum timeout is [div(get(%q0/config_timeout),86400)] days.,)]}}
&CMD_+BBCOLORS [v(dbref_bbs)]=$+bbcolors:@pemit %#=[u(fn_border_cent,Myrddin's Global BBS v[get(#bbpocket/version)] - Global Colors,78)]%r[switch(version(),Rhost*,ifelse(hasflag(%#,setr(F,XTERMCOLOR)),,%r[center(ansi(rh,For best results you should: @set me=%qF),78)]%r),MUX*,ifelse(hasflag(%#,setr(F,COLOR256)),,%r[center(ansi(rh,For best results you should: @set me=%qF),78)]%r),Penn*,ifelse(hasflag(%#,setr(F,XTERM256)),,%r[center(ansi(rh,For best results you should: @set me=%qF),78)]%r))]%r[rjust(u(c,3,Type),30)][space(5)][u(c,3,Code)]%r[rjust(repeat(-,4),30)][space(5)][repeat(-,4)][iter(remove(lattr(#bbpocket/c_*),C_THEME),%r[rjust(rest(##,_),30)][space(5)][u(##,v(##))])]%r%rThese are the global colors.%b%b[ifelse(t(v(c_theme)),The BBS is using the '[u(c_3,v(c_theme))]' theme.,The BBS is not using a defined color theme.)]%r%r[ifelse(u(fn_bbs_staff,%#),{Change codes with +bbcolor:  +bbcolor <type>=<code>%rYou will need to 'escape' the %%0.  Example:%r%r[space(5)]+bbcolor timeout=ansi(r,[v(d_pzero)])%r%rThe BBS color system is currently [ifelse(v(do_color),on,off)].  To turn it [setr(0,ifelse(v(do_color),off,on))], type: +bbconfig color=%q0%r},)][u(fn_border,78)]
@pemit me=[space(strlen(BBS INSTALLER>))] (75%% done)
&CMD_+BBCOLOR [v(dbref_bbs)]=$+bbcolor *=*:@switch/first [u(fn_bbs_staff,%#)]=0,{@pemit %#=Huh?%b%b(Type "help" for help.)},{@switch [member(lattr(#bbpocket/c_*),ucstr(c_%0))]=0,{@pemit %#=[u(fn_bbprompt)] Not a valid color type.  Please see '+bbcolors' for types.},{@pemit %#=[u(fn_bbprompt)] BBS color '%0', old: [u(c_%0,v(C_%0))];&C_THEME #bbpocket;&C_%0 #bbpocket=%1;@pemit %#=[u(fn_bbprompt)] BBS color '%0', new: [u(c_%0,v(C_%0))]}}
@force me={&color_themes [v(dbref_bbpocket)]=[default([v(dbref_bbpocket)]/color_themes,subtle:bright:carnival:dreaming)]}
&ct_carnival [v(dbref_bbpocket)]=[setq(M,Extra flag required for proper colors)][switch(version(),Tiny*,Colortheme 'carnival' will not work on TinyMUSH,Rhost*,ifelse(hasflag(%#,setr(F,XTERMCOLOR)),You already have the %qF flag set.  Good.,%qM: @set me=%qF),MUX*,ifelse(hasflag(%#,setr(F,COLOR256)),You already have the %qF flag set.  Good.,%qM: @set me=%qF),Penn*,ifelse(hasflag(%#,setr(F,XTERM256)),You already have the %qF flag set.  Good.,%qM: @set me=%qF))]
&ct_carnival_1 [v(dbref_bbpocket)]=ansi(<#ff0087>,%0)
&ct_carnival_2 [v(dbref_bbpocket)]=ansi(c,%0)
&ct_carnival_3 [v(dbref_bbpocket)]=ansi(bh,%0)
&ct_carnival_staff   [v(dbref_bbpocket)]=ansi(mh,%0)
&ct_carnival_unread  [v(dbref_bbpocket)]=ansi(g,%0)
&ct_carnival_timeout [v(dbref_bbpocket)]=ansi(y,%0)
&ct_bright [v(dbref_bbpocket)]=Light, bright colors.
&ct_bright_1 [v(dbref_bbpocket)]=ansi(bh,%0)
&ct_bright_2 [v(dbref_bbpocket)]=ansi(gh,%0)
&ct_bright_3 [v(dbref_bbpocket)]=ansi(ch,%0)
&ct_bright_staff   [v(dbref_bbpocket)]=ansi(mh,%0)
&ct_bright_unread  [v(dbref_bbpocket)]=ansi(g,%0)
&ct_bright_timeout [v(dbref_bbpocket)]=ansi(y,%0)
&ct_subtle [v(dbref_bbpocket)]=A dark theme, not too vibrant.
&ct_subtle_1 [v(dbref_bbpocket)]=ansi(xh,%0)
&ct_subtle_2 [v(dbref_bbpocket)]=ansi(g,%0)
&ct_subtle_3 [v(dbref_bbpocket)]=ansi(h,%0)
&ct_subtle_staff   [v(dbref_bbpocket)]=ansi(mh,%0)
&ct_subtle_unread  [v(dbref_bbpocket)]=ansi(g,%0)
&ct_subtle_timeout [v(dbref_bbpocket)]=ansi(y,%0)
&ct_dreamingo [v(dbref_bbpocket)]=Extra Flags Required: Rhost requires XTERMCOLOR, MUX requires COLOR256, Penn requires XTERM256%rRhost and Penn can use '+deeppink2' instead of <#ff0087> if desired.[switch(version(),Tiny*,%r[u(c,3,Will not work on TinyMUSH.)],)]
&ct_dreamingo_1 [v(dbref_bbpocket)]=[setq(C,rotr(39 3f 45 48 45 3f 39%b,mul(rand(7),3)))][nsiter(lnum(1,strlen(%0)),ansi(0x[extract(%qC,add(1,mod(div(#@,3),words(%qC))),1)]/,elementpos(%0,#@)))]
&ct_dreamingo_2 [v(dbref_bbpocket)]=ansi(c,%0)
&ct_dreamingo_3 [v(dbref_bbpocket)]=ansi(b,%0)
&ct_dreaming [v(dbref_bbpocket)]=Extra Flags Required: Rhost requires XTERMCOLOR, MUX requires COLOR256, Penn requires XTERM256[switch(version(),Tiny*,%r[u(c,3,Will not work on TinyMUSH.)],)]
&ct_dreaming [v(dbref_bbpocket)]=[setq(M,Extra flag required for proper colors)][switch(version(),Tiny*,Colortheme 'dreaming' will not work on TinyMUSH,Rhost*,ifelse(hasflag(%#,setr(F,XTERMCOLOR)),You already have the %qF flag set.  Good.,%qM: @set me=%qF),MUX*,ifelse(hasflag(%#,setr(F,COLOR256)),You already have the %qF flag set.  Good.,%qM: @set me=%qF),Penn*,ifelse(hasflag(%#,setr(F,XTERM256)),You already have the %qF flag set.  Good.,%qM: @set me=%qF))]
&ct_dreaming_1 [v(dbref_bbpocket)]=[setq(0,#5f00ff)][setq(1,#5f5fff)][setq(2,#5f87ff)][setq(3,#5faf87)][setq(4,#5f87ff)][setq(5,#5f5fff)][setq(6,#5f00ff)][setq(I,rand(7))][iter(lnum(0,div(strlen(%0),3)),ansi(<[r(%qI)][setq(I,mod(add(%qI,1),7))]>,mid(%0,mul(##,3),3)),,@@)]
@switch first(version())=Penn*,{@edit/quiet [v(dbref_bbpocket)]/ct_dreaming*=@@,}
@switch first(version())=Rhost*,{@edit [v(dbref_bbpocket)]/ct_dreaming*=@@,}
&ct_dreaming_2 [v(dbref_bbpocket)]=ansi(<#06989A>/,%0)
&ct_dreaming_3 [v(dbref_bbpocket)]=ansi(<#1656A1>/,%0)
&ct_dreaming_staff   [v(dbref_bbpocket)]=ansi(mh,%0)
&ct_dreaming_unread  [v(dbref_bbpocket)]=ansi(g,%0)
&ct_dreaming_timeout [v(dbref_bbpocket)]=ansi(y,%0)
&CMD_+BBCOLORTHEMES [v(dbref_bbs)]=$+bbcolorthemes:@pemit %#=%r[u(fn_border_cent,Myrddin's Global BBS v[get(#bbpocket/version)] - Color Themes,78)][iter(v(color_themes),%r%r[u(ct_##_3,##)]%r[u(ct_##_1,repeat(-,57))]%r[ifelse(hasattr(#bbpocket,ct_##),[u(ct_##)]%r%r,)][space(5)][ljust(1:,5)][ljust(u(ct_##_1,v(ct_##_1)),25)] [ljust(staff:,10)][u(ct_##_staff,v(ct_##_staff))]%r[space(5)][ljust(2:,5)][ljust(u(ct_##_2,v(ct_##_2)),25)] [ljust(unread:,10)][u(ct_##_unread,v(ct_##_unread))]%r[space(5)][ljust(3:,5)][ljust(u(ct_##_3,v(ct_##_3)),25)] [ljust(timeout:,10)][u(ct_##_timeout,v(ct_##_timeout))]%r[u(ct_##_1,repeat(-,57))],:)]%r%r[setq(T,v(c_theme))][ifelse(hasattr(#bbpocket,c_theme),The BBS is using the '[u(ct_%qT_3,%qT)]' color theme.%r,)][ifelse(hasattr(%#,_c_theme),You are personally using the '[u(c,3,get(%#/_c_theme))]' color theme.%r,)]%r[ifelse(u(fn_bbs_staff,%#),u(c,2,To set the global color theme:)]  +bbcolortheme <theme>%r,)][u(c,2,To set a personal color theme:)]  +bbcolortheme/me <theme>%r[u(c,2,To clear your personal color theme:)]  +bbcolortheme/me/clear%r[u(fn_border,78)]
&cmd_+bbcolortheme [v(dbref_bbs)]=$+bbcolortheme *:@switch/first [u(fn_bbs_staff,%#)]=0,{@pemit %#=[u(fn_bbprompt)] You're not allowed to change the global color theme.  Perhaps you meant '+bbcolortheme/me %0'?},{@switch [match(v(color_themes),%0,:)]=0,{@pemit %#=[u(fn_bbprompt)] Not a valid color theme  Please see '+bbcolorthemes' for types.},{@pemit %#=[u(fn_border_cent,Myrddin's Global BBS v[v(version)] - Setting Global Color Theme,78)]%rSetting Theme: [u(c,3,%0)]%r%rOld [ljust('1':,13)][u(c_1,v(C_1))]%rOld [ljust('2':,13)][u(c_2,v(C_2))]%rOld [ljust('3':,13)][u(c_3,v(C_3))]%rOld [ljust('staff':,13)][u(c_staff,v(C_staff))]%rOld [ljust('unread':,13)][u(c_unread,v(C_unread))]%rOld [ljust('timeout':,13)][u(c_timeout,v(C_timeout))]%r;&C_theme #bbpocket=[lcstr(%0)];&C_1 #bbpocket=[v(ct_%0_1)];&C_2 #bbpocket=[v(ct_%0_2)];&C_3 #bbpocket=[v(ct_%0_3)];&C_staff #bbpocket=[v(ct_%0_staff)];&C_unread #bbpocket=[v(ct_%0_unread)];&C_timeout #bbpocket=[v(ct_%0_timeout)];@pemit %#=New [ljust('1':,13)][u(c_1,v(C_1))]%rNew [ljust('2':,13)][u(c_2,v(C_2))]%rNew [ljust('3':,13)][u(c_3,v(C_3))]%rNew [ljust('staff':,13)][u(c_staff,v(C_staff))]%rNew [ljust('unread':,13)][u(c_unread,v(C_unread))]%rNew [ljust('timeout':,13)][u(c_timeout,v(C_timeout))]%r;@pemit %#=[u(fn_border,78)]}}
&cmd_+bbcolortheme/add [v(dbref_bbs)]=$+bbcolortheme/add *:@switch/first [u(fn_bbs_staff,%#)]=0,{@pemit %#=Huh?%b%b(Type "help" for help.)},{th [setq(T,first(%0,=))][setq(D,rest(%0,=))];@switch [match(v(color_themes),%qT,:)]=0,{&c_theme  #bbpocket=%qT;&ct_%qT   #bbpocket=%qD;&ct_%qT_1 #bbpocket=[v(c_1)];&ct_%qT_2 #bbpocket=[v(c_2)];&ct_%qT_3 #bbpocket=[v(c_3)];&ct_%qT_staff #bbpocket=[v(c_staff)];&ct_%qT_unread #bbpocket=[v(c_unread)];&ct_%qT_timeout #bbpocket=[v(c_timeout)];&color_themes #bbpocket=[setunion(v(color_themes),%qT,:)];@pemit %#=[u(fn_bbprompt)] Current colors have been saved as color theme '%qT'.},{@pemit %#=[u(fn_bbprompt)] Color theme '%qT' already exists.  Choose a new new name, or '+bbcolortheme/del %qT' first.}}
&cmd_+bbcolortheme/del [v(dbref_bbs)]=$+bbcolortheme/del *:@switch/first [u(fn_bbs_staff,%#)]=0,{@pemit %#=Huh?%b%b(Type "help" for help.)},{@switch [match(v(color_themes),%0,:)]=0,{@pemit %#=[u(fn_bbprompt)] Not an existing color theme.  Please see '+bbcolorthemes' for the current list.},{@switch strmatch(v(c_theme),%0)={&c_theme #bbpocket};&ct_%0_1 #bbpocket;&ct_%0_2 #bbpocket;&ct_%0_3 #bbpocket;&ct_%0_staff #bbpocket;&ct_%0_unread #bbpocket;&ct_%0_timeout #bbpocket;&color_themes #bbpocket=[ldelete(v(color_themes),match(v(color_themes),%0,:),:)];@pemit %#=[u(fn_bbprompt)] Color theme '%0' deleted.}}
&cmd_+bbcolortheme/me [v(dbref_bbs)]=$+bbcolortheme/me *:@switch [match(v(color_themes),%0,:)]=0,{@pemit %#=[u(fn_bbprompt)] Color theme '%0' doesn't exist.  Please see '+bbcolorthemes' for the current list.},{&_c_theme %#=[lcstr(%0)];&_c_1 %#=[v(ct_%0_1)];&_c_2 %#=[v(ct_%0_2)];&_c_3 %#=[v(ct_%0_3)];&_c_staff %#=[v(ct_%0_staff)];&_c_unread %#=[v(ct_%0_unread)];&_c_timeout %#=[v(ct_%0_timeout)];@pemit %#=[u(fn_bbprompt)] [u(c,1,repeat(-,40))];@pemit %#=[u(fn_bbprompt)] [u(ct_%0)];@pemit %#=[u(fn_bbprompt)] [u(c,1,repeat(-,40))];@pemit %#=[u(fn_bbprompt)] You are now using color theme '%0'.;@pemit %#=[u(fn_bbprompt)] [u(c,1,repeat(-,40))];}
&cmd_+bbcolortheme/me/clear [v(dbref_bbs)]=$+bbcolortheme/me/clear:&_c_theme %#;&_c_1 %#;&_c_2 %#;&_c_3 %#;&_c_staff %#;&_c_unread %#;&_c_timeout %#;@pemit %#=[u(fn_bbprompt)] Personal color theme cleared.  You're now using the global bb color theme.
&CMD_+BBSEARCH [v(dbref_bbs)]=$+bbsearch */*:@switch [member(u(valid_groups,%#,write),setr(0,u(get_group,%0)))]:[hasattr(%q0,anonymous)]:[isdbref(setr(1,locate(%#,*%1,p)))]=0:*:*,{@pemit %#=[u(fn_bbprompt)] BB Group '%0' is either an invalid Group, an unreadable Group, or a Group you do not subscribe to.},1:1:*,{@pemit %#=[u(fn_bbprompt)] BB Group '[name(%q0)]' is an anonymous group.},1:0:0,{@pemit %#=[u(fn_bbprompt)] No such character '%1'.},{@switch [words(setr(2,ulocal(fn_sort_b36,iter(grep(%q0,hdr_*,|%q1|),after(##,_)))))]=0,{@pemit %#=[u(fn_bbprompt)] [name(%q1)] hasn't posted any messages to the '[name(%q0)]' Group.},{@pemit %#=%r[u(fn_border,78)]%r[center(**** [name(%q0)] ****,78)]%r[space(8)]Message[space(28)]Posted[space(13)]By%r[u(fn_line,78)];@dolist %q2={@pemit %#=[ljust([member(get(#bbpocket/groups),%q0)]/[u(fn_ord_by_id,%q0,##)],6)][ljust(u(#bbpocket/fn_msg_flags,%#,%q0,##),2)][ljust(index(setr(3,get(%q0/hdr_##)),|,1,1),35)][ljust(u(bbtime_view,index(%q3,|,2,1)),19)][mid([index(%q3,|,3,1)],0,21)][switch(member(%q2,##),words(%q2),%r[u(fn_border,78)])]}}}
&CMD_+BBNOTIFY [v(dbref_bbs)]=$+bbnotify *=*:@switch/first [member(u(#bbpocket/valid_groups,%#,read),setr(0,u(#bbpocket/get_group,%0)))]:[member(on off,lcstr(%1))]:[lcstr(%1)]=0:*:*,{@pemit %#=[u(fn_bbprompt)] [switch(%q0,#-2,That Group name is not specific enough.,You do not subscribe to that Group.)]},*:0:*,{@pemit %#=[u(fn_bbprompt)] Invalid choice '%1'. Choices are 'on' or 'off'.},*:*:off,{&bb_silent %#=[setunion(get(%#/bb_silent),%q0)]; @pemit %#=[u(fn_bbprompt)] Post notification for BB Group '[name(%q0)]' turned off. You will no longer be notified of new postings to that Group.},{&bb_silent %#=[setdiff(get(%#/bb_silent),%q0)]; @pemit %#=[u(fn_bbprompt)] Post notification for BB Group '[name(%q0)]' turned on. You will now be notified of new postings to that Group.}
&CMD_+BBREPLY [v(dbref_bbs)]=$+bbreply */*:@switch [strmatch(%1,*=*)]:[hasattr(#bbpocket,bb_post_hdr_%#)]=0:1,{@pemit %#=[u(fn_bbprompt)] You are already in the middle of writing a bbpost (+bbproof to proofread it, +bbtoss to discard).},0:0,{@switch [setq(1,trunc(%1))][member(u(valid_groups,%#,write),setr(B,u(get_group,%0)))]=0,{ @pemit %#=[u(fn_bbprompt)] [switch(%qB,#-2,That Group name is not specific enough.,You do not subscribe to that Group.)]},{@switch t(ulocal(fn_id,%0/%q1))=0,{@pemit %#=[u(fn_bbprompt)] Message %0/%q1 ([name(%0)]/%q1) does not exist.},{th [setq(M,get(%qB/MESS_LST))][setq(I,extract(%qM,%q1,1))][setq(I,default(%qB/parent_%qI,%qI))][setq(S,re: [index(get(%qB/hdr_%qI),|,1,1)])][setq(U,u(fn_message_subject,get(%qB/hdr_%qI)))];&bb_post_hdr_%# #bbpocket=%qB|%qS|reply|%qI;@pemit %#=%rYou start your reply to '%qU' on Group #[member(v(groups),%qB)] ([name(%qB)]).%rYou can now compose the body of the post by using '+bbwrite <text>'%ror '+bb <text>'.  When you are finished, type '+bbpost' by itself.[ifelse(and(hasattr(%#,bb_sig),hasattr(%q0,anonymous)),{%b%bThis is an anonymous group. Your BB_SIG will -not- be appended.},)];}}}
&TR_POST_REPLY [v(dbref_bbpocket)]=th [setq(B,%0)][setq(I,%1)][setq(N,v(nxt_mess))][setq(S,index(get(%qB/hdr_%qI),|,1,1))][setq(U,u(fn_message_subject,get(%qB/hdr_%qI)))];&nxt_mess #bbpocket=[ulocal(fn_inc_next_mess,%qN)];&master_lst #bbpocket=[cat(v(master_lst),%qN)];&parent_%qN %qB=%qI;&hdr_%qN %qB=re: %qS|[u(bbtime)]|[edefault(%qB/anonymous,mid(name(%2),0,24))]|[owner(%2)]|[ifelse(get(%qB/config_timeout),add(get(%qB/config_timeout),secs()),0)];&bdy_%qN %qB=[%3][ifelse(and(hasattr(%2,bb_sig),not(hasattr(%qB,anonymous))),{%r[objeval(%2,eval(%2,bb_sig))]},)];&reply_%qI %qB=[get(%qB/reply_%qI)] %qN;&last_mod %qB=[u(bbtime)];@pemit %2=[u(fn_bbprompt)] You post your reply to '%qU' in Group [member(v(groups),%qB)] ([name(%qB)])[ifelse(and(hasattr(%2,bb_sig),hasattr(%qB,anonymous)),{%b%bThis is an anonymous group, your BB_SIG was -not- appended.},)];&bb_read %2=[setunion(get(%2/bb_read),%qN)];@trigger #bbpocket/tr_post_notify=%2,%qB,[member(get(%qB/MESS_LST),%qI)].[member(get(%qB/REPLY_%qI),%qN)],\(reply to: %qU\)
&CMD_+BBREPLY2 [v(dbref_bbs)]=$+bbreply */*=*:@switch/first [setq(1,trunc(%1))][member(u(valid_groups,%#,write),setr(B,u(get_group,%0)))]:[t(ulocal(fn_id,%0/%q1))]=0:*,{ @pemit %#=[u(fn_bbprompt)] [switch(%qB,#-2,That Group name is not specific enough.,You do not subscribe to that Group.)]},*:0,{ @pemit %#=[u(fn_bbprompt)] Message %0/%q1 ([name(%0)]/%q1) does not exist. },{th [setq(I,extrat(get(%qB/MESS_LST),%q1,1))][setq(I,default(%qB/parent_%qI,%qI))];@trigger #bbpocket/tr_post_reply=%qB,%qI,%#,%2}
&FN_READABLE_IDS [v(dbref_bbpocket)]=iter(u(valid_groups,%0,read),[setq(L,ulocal(fn_mess_list_threaded,##))][ifelse(words(%qL),%qL%b,)],%b,)
&CMD_+BBNEXT [v(dbref_bbs)]=$+bbnext:@switch/first words(setr(U,ulocal(fn_sort_b36,setdiff(u(fn_readable_ids,%#),get(%#/bb_read)))))=0,{@pemit %#=[u(fn_bbprompt)] No unread messages.},{@pemit %#=[ulocal(fn_msg,first(%qU))];&bb_read %#=[setunion(get(%#/bb_read),first(%qU))];@wait 2={&bb_read %#=[setinter(get(%#/bb_read),v(master_lst))]}}
&CMD_+BBNEXT2 [v(dbref_bbs)]=$+bbnext *:@switch member(u(valid_groups,%#,read),setr(0,u(get_group,%0)))=0,{@pemit %#=[u(fn_bbprompt)] [switch(%q0,#-2,That Group name is not specific enough.,You do not subscribe to that Group.)]},{@switch/first words(setr(U,ulocal(fn_sort_b36,setdiff(ulocal(fn_mess_list_threaded,%q0),get(%#/bb_read)))))=0,{@pemit %#=[u(fn_bbprompt)] No unread messages in '[name(%q0)]'.},{@pemit %#=[ulocal(fn_msg,first(%qU))];&bb_read %#=[setunion(get(%#/bb_read),first(%qU))];@wait 2={&bb_read %#=[setinter(get(%#/bb_read),v(master_lst))]}}}
&FN_HACKED_ATTRS [v(dbref_bbpocket)]=switch(version(),Tiny*,,squish([iter(v(sign_attrs_bbs),switch(u(fn_sha1,v(dbref_bbs),##),extract(v(sign_sha1_bbs),#@,1),,##))][iter(v(sign_attrs_bbpocket),switch(u(fn_sha1,#bbpocket,##),extract(v(sign_sha1_bbpocket),#@,1),,##))]))
&D_HINTS [v(dbref_bbpocket)]=You can reply directly to a BB posting with +bbreply (eg. '+bbreply 1/3')|Try '+bbnew' for a nice listing of unread messages. Also: '+bbnew/<group>'|
&FN_GETHINT [v(dbref_bbpocket)]=@pemit %#=[u(fn_bbprompt)] [u(c,2,HINT:)] You can reply directly to a BB posting with +bbreply (eg. '+bbreply 1/3')
&CMD_+BBVERSION [v(dbref_bbs)]=$+bbversion:th [setq(H,ulocal(#bbpocket/fn_hacked_attrs))][setq(W,words(%qH))];@pemit %#=[u(fn_bbprompt)] Myrddin's BBS v[v(VERSION)] ([v(VERSION_BUILD)])[ifelse(%qW,%b+ local hacks,)][ifelse(%qW,%r[u(fn_bbprompt)] Hacked attributes: %qH,)]
@set [v(dbref_bbs)]=!HALT
@set [v(dbref_bbs)]=INHERIT
@set [v(dbref_bbs)]=SAFE
&FN_IFELSE [v(dbref_bbpocket)]=switch({%0},0,{%2},,{%2},{%1})
&FN_SETR [v(dbref_bbpocket)]=[setq(%0,%1)][s(\%q%0)]
&FN_GREP [v(dbref_bbpocket)]=iter(lattr(%0/%1),switch(strmatch(get(%0/##),*%2*),1,##))
@switch ifelse(1,1,0)=1,{@pemit %#=BBS INSTALLER> You have a working ifelse(). Good.; &FN_IFELSE [v(dbref_bbpocket)];},{@pemit %#=BBS INSTALLER> You don't have an ifelse() func. That's ok, I'll make my own.%r[space(15)]IMPORTANT: #1 Needs to execute the following command AND put%r[space(15)]it in its @startup:%r[space(15)]@function/priv ifelse=<dbref of bbpocket>/fn_ifelse}
@switch setr(0,1)=1,{@pemit %#=BBS INSTALLER> You have a working setr(). Good.; &FN_SETR [v(dbref_bbpocket)];},{@pemit %#=BBS INSTALLER> You don't have an setr() func. That's ok, I'll make my own.%r[space(15)]IMPORTANT: #1 Needs to execute the following command AND put%r[space(15)]it in its @startup:%r[space(15)]@function/priv setr=<dbref of bbpocket>/fn_setr}
@switch version()=TinyMUSH *version 3.*,{@set [v(dbref_bbs)]=COMMANDS; @set [v(dbref_bbs)]=STOP},TinyMUSH version 2.2.*,{@set [v(dbref_bbs)]=COMMANDS; @set [v(dbref_bbs)]=STOP},PennMUSH*,{@edit [v(dbref_bbs)]/CMD_+BBNEWGROUP=inherit,wizard;@set [v(dbref_bbpocket)]=!INHERIT;@set [v(dbref_bbpocket)]=WIZARD;@set [v(dbref_bbs)]=!INHERIT;@set [v(dbref_bbs)]=WIZARD;@set [v(dbref_bbs)]=!NO_COMMAND;@power [v(dbref_bbpocket)]=see_all;@edit [v(dbref_bbs)]/CMD_+BBNEWGROUP={&CANREAD},{@set \%q0=NO_WARN; &CANREAD}}
@switch [setq(R,v(bb_read))][setq(O,v(bb_omit))][setq(S,v(bb_silent))]1=1,{&bb_read me=1;&bb_read me=%qR;&bb_omit me=1;&bb_omit me=%qO;&bb_silent me=1;&bb_silent me=%qS;}
@pemit %#=BBS INSTALLER> Cleaning up attributes...%r
@pemit %#=[switch(first(version()),MUX,------- This is MUX: Ignore the following 'Permission denied' messages -------)]
@force me=@edit[switch(first(version()),PennMUSH,/quiet)] [v(dbref_bbpocket)]/*=#bbpocket,[v(dbref_bbpocket)]
@force me=@edit[switch(first(version()),PennMUSH,/quiet)] [v(dbref_bbs)]/*=#bbpocket,[v(dbref_bbpocket)]
@wait 0=@pemit %#=[switch(first(version()),MUX,repeat(-,78))]
@wait 3={@tel [setq(0,v(dbref_bbpocket))][setq(1,v(dbref_bbs))]%q0=%q1;@name [v(dbref_bbs)]=BBS - Myrddin's Global BBS v[get(%q0/version)];@set me=!quiet}
@switch/first %#:[first(version())]=#1:Tiny*,{@attribute/access bb_read=hidden wizard;@attribute/access bb_omit=hidden wizard;@attribute/access bb_silent=hidden wizard;@attribute/access _c_1=hidden wizard;@attribute/access _c_2=hidden wizard;@attribute/access _c_3=hidden wizard;@attribute/access _c_staff=hidden wizard;@attribute/access _c_unread=hidden wizard;@attribute/access _c_timeout=hidden wizard;},*:Penn*,{@set [v(dbref_bbs)]=WIZARD;@power [v(dbref_bbs)]=no_pay;@power [v(dbref_bbpocket)]=no_pay;},*:Tiny*,{@pemit me=Reminder! Make sure #1 executes the following:%r%b%b@attribute/access bb_read=hidden wizard%r%b%b@attribute/access bb_omit=hidden wizard%r%b%b@attribute/access bb_silent=hidden wizard%r%b%b@attribute/access _c_1=hidden wizard%r%b%b@attribute/access _c_2=hidden wizard%r%b%b@attribute/access _c_3=hidden wizard%r%b%b@attribute/access _c_staff=hidden wizard%r%b%b@attribute/access _c_unread=hidden wizard%r%b%b@attribute/access _c_timeout=hidden wizard},*:Rhost*,{@set [v(dbref_bbs)]=SIDEFX},{@pemit me=Reminder! Make sure #1 sets the BBS WIZARD}
@wait 1={@pemit me=%rBulletin Board construction complete. Just place the Global BB in the Master Room... Enjoy!%rYou may want to look at the '+bbcolors' and '+bbcolorthemes' to acquaint yourself with the new color system.%r[repeat(=,78)]}
@wait 3={@switch v(_set_halt)=0,{&_set_halt me;},{@pemit me=BBS INSTALLER> Restoring your HALT flag;&_set_halt me;@set me=halt}}
